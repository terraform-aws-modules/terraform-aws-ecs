module "wrapper" {
  source = "../../modules/express-service"

  for_each = var.items

  cloudwatch_log_group_class                   = try(each.value.cloudwatch_log_group_class, var.defaults.cloudwatch_log_group_class, null)
  cloudwatch_log_group_kms_key_id              = try(each.value.cloudwatch_log_group_kms_key_id, var.defaults.cloudwatch_log_group_kms_key_id, null)
  cloudwatch_log_group_name                    = try(each.value.cloudwatch_log_group_name, var.defaults.cloudwatch_log_group_name, null)
  cloudwatch_log_group_retention_in_days       = try(each.value.cloudwatch_log_group_retention_in_days, var.defaults.cloudwatch_log_group_retention_in_days, 14)
  cloudwatch_log_group_tags                    = try(each.value.cloudwatch_log_group_tags, var.defaults.cloudwatch_log_group_tags, {})
  cluster                                      = try(each.value.cluster, var.defaults.cluster, null)
  cpu                                          = try(each.value.cpu, var.defaults.cpu, null)
  create                                       = try(each.value.create, var.defaults.create, true)
  create_cloudwatch_log_group                  = try(each.value.create_cloudwatch_log_group, var.defaults.create_cloudwatch_log_group, true)
  create_execution_iam_role                    = try(each.value.create_execution_iam_role, var.defaults.create_execution_iam_role, true)
  create_execution_policy                      = try(each.value.create_execution_policy, var.defaults.create_execution_policy, true)
  create_infrastructure_iam_role               = try(each.value.create_infrastructure_iam_role, var.defaults.create_infrastructure_iam_role, true)
  create_security_group                        = try(each.value.create_security_group, var.defaults.create_security_group, true)
  create_task_iam_role                         = try(each.value.create_task_iam_role, var.defaults.create_task_iam_role, true)
  execution_iam_policy_path                    = try(each.value.execution_iam_policy_path, var.defaults.execution_iam_policy_path, null)
  execution_iam_role_arn                       = try(each.value.execution_iam_role_arn, var.defaults.execution_iam_role_arn, null)
  execution_iam_role_description               = try(each.value.execution_iam_role_description, var.defaults.execution_iam_role_description, null)
  execution_iam_role_max_session_duration      = try(each.value.execution_iam_role_max_session_duration, var.defaults.execution_iam_role_max_session_duration, null)
  execution_iam_role_name                      = try(each.value.execution_iam_role_name, var.defaults.execution_iam_role_name, null)
  execution_iam_role_path                      = try(each.value.execution_iam_role_path, var.defaults.execution_iam_role_path, null)
  execution_iam_role_permissions_boundary      = try(each.value.execution_iam_role_permissions_boundary, var.defaults.execution_iam_role_permissions_boundary, null)
  execution_iam_role_policies                  = try(each.value.execution_iam_role_policies, var.defaults.execution_iam_role_policies, {})
  execution_iam_role_tags                      = try(each.value.execution_iam_role_tags, var.defaults.execution_iam_role_tags, {})
  execution_iam_role_use_name_prefix           = try(each.value.execution_iam_role_use_name_prefix, var.defaults.execution_iam_role_use_name_prefix, true)
  execution_iam_statements                     = try(each.value.execution_iam_statements, var.defaults.execution_iam_statements, null)
  execution_secret_arns                        = try(each.value.execution_secret_arns, var.defaults.execution_secret_arns, [])
  execution_ssm_param_arns                     = try(each.value.execution_ssm_param_arns, var.defaults.execution_ssm_param_arns, [])
  health_check_path                            = try(each.value.health_check_path, var.defaults.health_check_path, null)
  infrastructure_iam_role_arn                  = try(each.value.infrastructure_iam_role_arn, var.defaults.infrastructure_iam_role_arn, null)
  infrastructure_iam_role_description          = try(each.value.infrastructure_iam_role_description, var.defaults.infrastructure_iam_role_description, null)
  infrastructure_iam_role_name                 = try(each.value.infrastructure_iam_role_name, var.defaults.infrastructure_iam_role_name, null)
  infrastructure_iam_role_path                 = try(each.value.infrastructure_iam_role_path, var.defaults.infrastructure_iam_role_path, null)
  infrastructure_iam_role_permissions_boundary = try(each.value.infrastructure_iam_role_permissions_boundary, var.defaults.infrastructure_iam_role_permissions_boundary, null)
  infrastructure_iam_role_tags                 = try(each.value.infrastructure_iam_role_tags, var.defaults.infrastructure_iam_role_tags, {})
  infrastructure_iam_role_use_name_prefix      = try(each.value.infrastructure_iam_role_use_name_prefix, var.defaults.infrastructure_iam_role_use_name_prefix, true)
  memory                                       = try(each.value.memory, var.defaults.memory, null)
  name                                         = try(each.value.name, var.defaults.name, "")
  network_configuration                        = try(each.value.network_configuration, var.defaults.network_configuration, null)
  primary_container                            = try(each.value.primary_container, var.defaults.primary_container, null)
  region                                       = try(each.value.region, var.defaults.region, null)
  scaling_target                               = try(each.value.scaling_target, var.defaults.scaling_target, null)
  security_group_description                   = try(each.value.security_group_description, var.defaults.security_group_description, null)
  security_group_egress_rules                  = try(each.value.security_group_egress_rules, var.defaults.security_group_egress_rules, {})
  security_group_ingress_rules                 = try(each.value.security_group_ingress_rules, var.defaults.security_group_ingress_rules, {})
  security_group_name                          = try(each.value.security_group_name, var.defaults.security_group_name, null)
  security_group_tags                          = try(each.value.security_group_tags, var.defaults.security_group_tags, {})
  security_group_use_name_prefix               = try(each.value.security_group_use_name_prefix, var.defaults.security_group_use_name_prefix, true)
  tags                                         = try(each.value.tags, var.defaults.tags, {})
  task_iam_role_arn                            = try(each.value.task_iam_role_arn, var.defaults.task_iam_role_arn, null)
  task_iam_role_description                    = try(each.value.task_iam_role_description, var.defaults.task_iam_role_description, null)
  task_iam_role_max_session_duration           = try(each.value.task_iam_role_max_session_duration, var.defaults.task_iam_role_max_session_duration, null)
  task_iam_role_name                           = try(each.value.task_iam_role_name, var.defaults.task_iam_role_name, null)
  task_iam_role_path                           = try(each.value.task_iam_role_path, var.defaults.task_iam_role_path, null)
  task_iam_role_permissions_boundary           = try(each.value.task_iam_role_permissions_boundary, var.defaults.task_iam_role_permissions_boundary, null)
  task_iam_role_policies                       = try(each.value.task_iam_role_policies, var.defaults.task_iam_role_policies, {})
  task_iam_role_statements                     = try(each.value.task_iam_role_statements, var.defaults.task_iam_role_statements, null)
  task_iam_role_tags                           = try(each.value.task_iam_role_tags, var.defaults.task_iam_role_tags, {})
  task_iam_role_use_name_prefix                = try(each.value.task_iam_role_use_name_prefix, var.defaults.task_iam_role_use_name_prefix, true)
  vpc_id                                       = try(each.value.vpc_id, var.defaults.vpc_id, null)
}
